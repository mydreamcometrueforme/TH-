<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BÁO ĐƠN</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <form id="mainForm">
    <h1 class="main-title">BÁO ĐƠN</h1>

    <!-- 1. Thông tin Đơn -->
    <section class="form-section">
      <h2>1. Thông tin Đơn</h2>

      <div class="form-group half-width">
        <label for="office">Văn phòng:</label>
        <select id="office" name="office" required>
          <option value="">-- Chọn Văn phòng --</option>
          <option value="ThaiHa">Thái Hà</option>
          <option value="NguyenXien">Nguyễn Xiển</option>
        </select>
      </div>

      <div class="form-group half-width">
        <label for="date">Ngày làm đơn:</label>
        <input type="date" id="date" name="date" value="" required />
      </div>

      <div class="form-group half-width">
        <label for="staff">Nhân viên:</label>
        <select id="staff" name="staff" required disabled>
          <option value="">-- Vui lòng chọn Văn phòng trước --</option>
        </select>
      </div>

      <div class="form-group half-width">
        <label for="staffShip">Nhân viên SHIP:</label>
        <select id="staffShip" name="staffShip" required>
          <option value="Không">Không</option>
        </select>
      </div>

      <div id="customerDetailField" class="form-group hidden">
        <label for="customerDetail">Chi tiết Khách văn phòng:</label>
        <input type="text" id="customerDetail" name="customerDetail" placeholder="Liên hệ" />
      </div>
    </section>

    <!-- 2. Thông tin Thẻ -->
    <div id="cardContainer">
      <section class="form-section card-item" data-card-id="1">
        <h2>2. Thông tin Thẻ #1</h2>

        <div class="form-group">
          <label for="cardName_1">Họ và tên chủ thẻ:</label>
          <input type="text" id="cardName_1" name="cardName_1" required />
        </div>

        <div class="form-group half-width">
          <label for="cardNumber_1">4 số đuôi thẻ:</label>
          <input type="text" id="cardNumber_1" name="cardNumber_1" maxlength="4" required />
        </div>

        <div class="form-group half-width">
          <label for="cardType_1">Loại thẻ:</label>
          <select id="cardType_1" name="cardType_1" required>
            <option value="V">Visa</option>
            <option value="M">MasterCard</option>
            <option value="J">JCB</option>
            <option value="n">Napas</option>
          </select>
        </div>

        <!-- Ngân hàng + Dịch vụ cùng 1 dòng -->
        <div class="form-row">
          <div class="form-group half-width">
            <label for="cardBank_1">Ngân hàng thẻ:</label>
            <input type="text" id="cardBank_1" name="cardBank_1" required />
          </div>

          <div class="form-group half-width">
            <label for="serviceType_1">Dịch vụ làm:</label>
            <select id="serviceType_1" name="serviceType_1" class="service-selector card-input" required>
              <option value="">-- Chọn Dịch vụ --</option>
              <option value="DAO">ĐÁO</option>
              <option value="RUT">RÚT</option>
              <option value="DAO_RUT">ĐÁO+RÚT</option>
            </select>
          </div>
        </div>

        <!-- Chi tiết theo dịch vụ -->
        <div class="service-details-container hidden" id="serviceDetails_1">

          <!-- Tiền chuyển (định dạng tiền tệ) -->
          <div class="form-group">
            <label for="transferAmount_1">Tiền chuyển:</label>
            <input
              type="text"
              id="transferAmount_1"
              name="transferAmount_1"
              value="0"
              class="card-input currency-input"
              inputmode="numeric"
              placeholder="0"
            />
          </div>

          <!-- Tổng tiền làm + Phí âm/Back khách (không màu mè) -->
          <div class="plain-metrics">
            <div class="metric-row">
              <span class="metric-label">Tổng tiền làm  thẻ :</span>
              <span class="metric-value"><span id="totalBillAmount_1">0</span> VNĐ</span>
            </div>

            <div class="metric-row">
              <span class="metric-label">Phí âm / Back khách:</span>
              <span class="metric-value"><span id="differenceAmount_1">0</span> VNĐ</span>
              <span class="metric-note">(tiền dương thẻ âm, tiền âm thừa/rút)</span>
            </div>
          </div>

          <!-- BILL -->
          <div class="bill-section">
            <div class="bill-section-head">
              <label>Nhập Bill:</label>
              <button type="button" class="add-bill-btn" data-card-id="1">➕ Thêm Bill</button>
            </div>

            <div class="bill-details-wrapper" id="billDetails_1">
             <div class="bill-row" data-bill-index="1">
  <input type="text" class="bill-label" name="billLabel_1_1" value="Bill 1" readonly />

  <input
    type="text"
    class="bill-amount card-input currency-input"
    name="billAmount_1_1"
    value="0"
    inputmode="numeric"
    placeholder="Số tiền"
    required
  />

  <select class="bill-pos card-input pos-select" name="billPOS_1_1" required>
    <option value="">-- Chọn POS --</option>
  </select>

  <select class="bill-hkd card-input hkd-select" name="billHKD_1_1" required>
    <option value="">-- Chọn HKD --</option>
  </select>

  <select class="bill-machine card-input machine-select" name="billMachine_1_1" required>
    <option value="">-- Chọn Máy POS --</option>
  </select>

  <input type="text" class="bill-batch card-input" name="billBatch_1_1" placeholder="Số lô" />
  <input type="text" class="bill-invoice card-input" name="billInvoice_1_1" placeholder="Số hóa đơn" />

  <button type="button" class="remove-bill-btn" title="Xóa bill">Xóa BILL</button>
</div>


        <button type="button" class="remove-card-btn" data-card-id="1">Xóa Thẻ này</button>
        <hr />
      </section>
    </div>

    <button type="button" id="addCardBtn">➕ Thêm Thẻ Mới</button>

    <!-- 3. Tính phí -->
    <section class="form-section final-summary">
      <h2>3. Tính phí</h2>

      <!-- Tổng tiền làm (tổng bill toàn bộ thẻ) -->
      <div class="calculation-result summary-item">
        <label>Tổng tiền làm (tổng bill toàn bộ thẻ):</label>
        <p id="totalBillAll">0 VNĐ</p>
      </div>

      <!-- Phí thu khách % -->
      <div class="form-group">
        <label for="feePercentAll">Phí thu khách (% trên tổng tiền làm):</label>
        <input
          type="number"
          id="feePercentAll"
          name="feePercentAll"
          min="0"
          step="0.01"
          value="0"
          class="card-input"
        />
      </div>

      <!-- Phí ship ngay dưới phí thu khách % -->
      <div class="form-group">
        <label for="shipFee">Phí ship:</label>
        <input
          type="text"
          id="shipFee"
          name="shipFee"
          value="0"
          class="card-input currency-input"
          inputmode="numeric"
          placeholder="0"
        />
      </div>

      <!-- Phí chuyển về % -->
      <div class="form-group">
        <label for="returnFeePercentAll">Phí chuyển về (%):</label>
        <input
          type="number"
          id="returnFeePercentAll"
          name="returnFeePercentAll"
          min="0"
          step="0.01"
          value="0"
          class="card-input"
        />
      </div>

      <!-- Sau % chuyển về: Tổng thu khách -->
      <div class="calculation-result summary-item">
        <label>Tổng thu khách:</label>
        <p id="totalFeeCollectedAll">0 VNĐ</p>
      </div>

      <!-- Phí thực thu (nhập) -->
      <div class="form-group">
        <label for="actualFeeReceived">Phí thực thu:</label>
        <input
          type="text"
          id="actualFeeReceived"
          name="actualFeeReceived"
          value=""
          class="card-input currency-input"
          inputmode="numeric"
          placeholder="Nhập phí thực thu (đã thu)"
        />
        <small style="display:block;color:#666;margin-top:6px;">Bỏ trống nếu chưa thu.</small>
      </div>

      <!-- Tổng trả khách -->
      <div class="calculation-result summary-item">
        <label>Tổng trả khách:</label>
        <p id="totalCustomerPayment">0 VNĐ</p>
      </div>

      <!-- Thanh toán phí để cuối -->
      <div class="form-group">
        <label for="feePaymentStatus">Thanh toán phí:</label>
        <select id="feePaymentStatus" name="feePaymentStatus" required>
          <option value="chua_thu">Chưa thu</option>
          <option value="da_thu">Đã thu</option>
        </select>
      </div>

      <button type="submit" class="submit-btn">Gửi Đơn</button>
    </section>
  </form>

  <script src="script.js"></script>
</body>
</html>
